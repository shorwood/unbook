---
title: Schema
description: Learn how to define and manage database schemas in Unbook.
navigation:
  icon: i-lucide-table-2
github: https://github.com/shorwood/unbook/blob/main/packages/core/src/types/schema.ts
---

## Define a schema

Schemas describe the structure of a data source (database table). In Unbook, you define schemas using field helper functions that create type-safe field definitions.

```ts [src/index.ts]
import { title, text, select, number, date, checkbox } from '@unbook/core/shorthands'

const taskSchema = {
  name: title('Task Name'),
  description: text('Description'),
  priority: select('Priority', ['Low', 'Medium', 'High']),
  storyPoints: number('Story Points'),
  dueDate: date('Due Date'),
  completed: checkbox('Completed'),
}
```

Each field helper takes a label (the display name) as its first argument, followed by type-specific options.

::note
The schema keys (e.g., `name`, `priority`) are your internal identifiers, while the label is what users see in the UI.
::

## Use field types

Unbook supports all common field types. Here's a complete reference:

### Title

The primary identifier field. Every data source must have exactly one title field.

```ts
import { title } from '@unbook/core/shorthands'

title('Name')
// { type: 'title', label: 'Name' }
```

### Rich Text

Multi-line text with formatting support.

```ts
import { text } from '@unbook/core/shorthands'

text('Description')
// { type: 'rich_text', label: 'Description' }
```

### Number

Numeric values with optional formatting.

```ts
import { number } from '@unbook/core/shorthands'

number('Price')
// { type: 'number', label: 'Price', format: 'number' }

number('Revenue', 'dollar')
// { type: 'number', label: 'Revenue', format: 'dollar' }

number('Completion', 'percent')
// { type: 'number', label: 'Completion', format: 'percent' }
```

Available formats: `number`, `number_with_commas`, `percent`, `dollar`, `canadian_dollar`, `euro`, `pound`, `yen`, `ruble`, `rupee`, `won`, `yuan`, and more.

### Select

Single-choice dropdown.

```ts
import { select } from '@unbook/core/shorthands'

// Simple array of options
select('Status', ['To Do', 'In Progress', 'Done'])

// Options with colors
select('Priority', {
  low: { label: 'Low', color: 'gray' },
  medium: { label: 'Medium', color: 'yellow' },
  high: { label: 'High', color: 'red' },
})
```

### Multi-Select

Multiple-choice tags.

```ts
import { multiSelect } from '@unbook/core/shorthands'

multiSelect('Tags', ['Frontend', 'Backend', 'DevOps'])

multiSelect('Labels', {
  bug: { label: 'Bug', color: 'red' },
  feature: { label: 'Feature', color: 'green' },
  docs: { label: 'Documentation', color: 'blue' },
})
```

### Status

Grouped status options with workflow semantics.

```ts
import { status } from '@unbook/core/shorthands'

status('Progress', {
  notStarted: {
    label: 'Not Started',
    color: 'gray',
    options: ['Backlog', 'Blocked'],
  },
  inProgress: {
    label: 'In Progress',
    color: 'yellow',
    options: ['Started', 'In Review'],
  },
  done: {
    label: 'Done',
    color: 'green',
    options: ['Completed', 'Archived'],
  },
})
```

### Date

Date and date-time values.

```ts
import { date } from '@unbook/core/shorthands'

date('Due Date')
// { type: 'date', label: 'Due Date' }
```

### People

User references.

```ts
import { people } from '@unbook/core/shorthands'

people('Assignee')
// { type: 'people', label: 'Assignee' }
```

### Files

File attachments.

```ts
import { files } from '@unbook/core/shorthands'

files('Attachments')
// { type: 'files', label: 'Attachments' }
```

### Checkbox

Boolean toggle.

```ts
import { checkbox } from '@unbook/core/shorthands'

checkbox('Completed')
// { type: 'checkbox', label: 'Completed' }
```

### URL

Web addresses.

```ts
import { url } from '@unbook/core/shorthands'

url('Website')
// { type: 'url', label: 'Website' }
```

### Email

Email addresses.

```ts
import { email } from '@unbook/core/shorthands'

email('Contact')
// { type: 'email', label: 'Contact' }
```

### Phone Number

Phone numbers.

```ts
import { phone } from '@unbook/core/shorthands'

phone('Mobile')
// { type: 'phone_number', label: 'Mobile' }
```

### Formula

Computed values based on other fields.

```ts
import { formula } from '@unbook/core/shorthands'

formula('Total', 'prop("Price") * prop("Quantity")')
// { type: 'formula', label: 'Total', expression: 'prop("Price") * prop("Quantity")' }
```

### Relation

Links to another data source.

```ts
import { relation } from '@unbook/core/shorthands'

// Dual relation (bidirectional)
relation('Project', 'project-data-source-id')

// Single relation (one-way)
relation('Parent Task', 'task-data-source-id', true)
```

### Rollup

Aggregate values from related records.

```ts
import { rollup } from '@unbook/core/shorthands'

rollup('Total Tasks', {
  relation_property: 'Tasks',
  rollup_property: 'Name',
  function: 'count',
})
```

Available functions: `count`, `count_values`, `empty`, `not_empty`, `unique`, `show_unique`, `percent_empty`, `percent_not_empty`, `sum`, `average`, `median`, `min`, `max`, `range`, `earliest_date`, `latest_date`, `date_range`, `checked`, `unchecked`, `percent_checked`, `percent_unchecked`, `show_original`.

### Timestamps and Audit Fields

Read-only fields for tracking.

```ts
import { createdTime, createdBy, lastEditedTime, lastEditedBy } from '@unbook/core/shorthands'

createdTime('Created')
// { type: 'created_time', label: 'Created' }

createdBy('Author')
// { type: 'created_by', label: 'Author' }

lastEditedTime('Updated')
// { type: 'last_edited_time', label: 'Updated' }

lastEditedBy('Editor')
// { type: 'last_edited_by', label: 'Editor' }
```

## Migrate schemas

When your schema evolves, Unbook provides utilities to detect and apply changes.

### Detect schema differences

Use `diffSchema` to compare two schema definitions:

```ts [src/index.ts]
import { diffSchema } from '@unbook/core/utils'

const currentSchema = {
  name: { type: 'title', label: 'Name' },
  status: { type: 'select', label: 'Status', options: ['Active'] },
}

const targetSchema = {
  name: { type: 'title', label: 'Name' },
  status: { type: 'select', label: 'Status', options: ['Active', 'Archived'] },
  priority: { type: 'select', label: 'Priority', options: ['Low', 'High'] },
}

const changes = diffSchema(currentSchema, targetSchema)
console.log(changes)
// [
//   { type: 'update', key: 'status', field: { ... } },
//   { type: 'add', key: 'priority', field: { ... } },
// ]
```

### Apply schema changes

Use `applySchemaChanges` to generate the property updates:

```ts [src/index.ts]
import { applySchemaChanges, diffSchema } from '@unbook/core/utils'

const changes = diffSchema(currentSchema, targetSchema)
const propertyUpdates = applySchemaChanges(changes, 'merge')

// Apply to data source
await dataSource.update({ properties: propertyUpdates })
```

### Use ensureSchema for automatic migration

The simplest approach is to use the `ensureSchema` method on a data source:

```ts [src/index.ts]
import { title, select, checkbox } from '@unbook/core/shorthands'

const schema = {
  name: title('Name'),
  status: select('Status', ['Active', 'Archived']),
  featured: checkbox('Featured'),
}

// Automatically detect and apply changes
const updatedDataSource = await dataSource.ensureSchema(schema, 'merge')
```

::warning
The `overwrite` strategy will delete fields that exist remotely but not in your schema. Use with caution in production.
::

### Conflict strategies

| Strategy | Behavior |
| --- | --- |
| `strict` | Throws an error if remote has fields not in your schema |
| `merge` | Keeps remote fields that don't conflict, adds/updates local fields |
| `overwrite` | Replaces remote schema entirely (deletes remote-only fields) |
