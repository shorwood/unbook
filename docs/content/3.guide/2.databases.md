---
title: Databases
description: Learn how to create, manage, and query databases and their data sources.
navigation:
  icon: i-lucide-database
---

Databases are containers that hold one or more data sources (tables). Each data source has its own schema and stores rows of data as pages.

## Understand databases vs data sources

In Unbook, the data model distinguishes between two concepts:

- **Database**: A container that groups related data sources. Think of it as a "workbook" in spreadsheet terms.
- **DataSource**: The actual table with a schema and rows. Think of it as a "sheet" within the workbook.

```
Database (Tasks Manager)
‚îú‚îÄ‚îÄ DataSource (Tasks)        ‚Üê Primary table with task rows
‚îú‚îÄ‚îÄ DataSource (Sprints)      ‚Üê Additional table for sprint planning
‚îî‚îÄ‚îÄ DataSource (Team Members) ‚Üê Additional table for team data
```

Most databases have a single data source, but multi-table databases are supported.

## Create a database

Use `workspace.createDatabase()` to create a new database:

```ts [create-database.ts]
import { Notion } from '@unbook/notion'
import { Workspace, fields } from '@unbook/core'

const adapter = new Notion({ auth: process.env.NOTION_TOKEN })
const workspace = new Workspace(adapter)

// Create a database with a schema
const parentPage = await workspace.getPage('parent-page-id')
const database = await workspace.createDatabase('Tasks', {
  parent: parentPage,
  schema: {
    name: fields.title('Name'),
    status: fields.select('Status', ['To Do', 'In Progress', 'Done']),
    dueDate: fields.date('Due Date'),
    assignee: fields.people('Assignee'),
  },
})

console.log('Database created:', database.id)
```

### Create with icon and cover

When creating a database, you can also set an icon, cover image, and description:

```ts [create-database-styled.ts]
const database = await workspace.createDatabase('Project Tracker', {
  parent: parentPage,
  icon: '@iconify/carbon:rocket.svg',
  cover: 'https://example.com/cover.jpg',
  description: 'Track all project tasks and milestones',
  schema: {
    name: fields.title('Name'),
    status: fields.select('Status', ['To Do', 'In Progress', 'Done']),
  },
})
```

## Retrieve a database

Use `workspace.getDatabase()` to fetch a database by ID:

```ts [get-database.ts]
const database = await workspace.getDatabase('database-id-here')

// Access database properties
console.log('ID:', database.id)
console.log('Title:', database.title)
console.log('Description:', database.description)
console.log('URL:', database.url)
console.log('Is archived:', database.isArchived)
console.log('Is inline:', database.isInline)
console.log('Created:', database.createdAt)
console.log('Last edited:', database.lastEditedAt)
```

## Navigate database relationships

### Get the parent

A database's parent is typically a Page or Block:

```ts [get-database-parent.ts]
const parent = await database.getParent()

if (parent instanceof Page) {
  console.log('Parent page:', parent.title)
} else if (parent instanceof Block) {
  console.log('Parent block:', parent.type)
} else {
  console.log('Database is at workspace root')
}
```

### Get data sources

List all data sources in the database:

```ts [get-data-sources.ts]
// Get the primary (first) data source
const primaryDataSource = await database.getPrimaryDataSource()
console.log('Primary table:', primaryDataSource.title)

// Iterate over all data sources
for await (const dataSource of database.getDataSources()) {
  console.log('Data source:', dataSource.title)
}

// Get a specific data source by ID
const specific = await database.getDataSource('data-source-id')
```

### Get creator and last editor

```ts [get-database-users.ts]
const creator = await database.getCreator()
console.log('Created by:', creator.name)

const editor = await database.getLastEditor()
console.log('Last edited by:', editor.name)
```

## Create data sources within a database

Add additional tables to an existing database:

```ts [create-data-source.ts]
// Add a new data source to the database
const sprintsTable = await database.createDataSource({
  title: 'Sprints',
  icon: 'üèÉ',
  schema: {
    name: { label: 'Sprint Name', type: 'title' },
    startDate: { label: 'Start Date', type: 'date' },
    endDate: { label: 'End Date', type: 'date' },
    goal: { label: 'Goal', type: 'rich_text' },
  },
})

console.log('New data source:', sprintsTable.id)
```

## Update database settings

Use `database.update()` to modify database properties:

```ts [update-database.ts]
const updated = await database.update({
  title: 'Updated Database Name',
  description: 'New description for the database',
  icon: 'üéØ',
  cover: 'https://example.com/new-cover.jpg',
})
```

## Archive and delete databases

### Archive a database

Archiving moves the database to trash but allows recovery:

```ts [archive-database.ts]
await database.archive()
console.log('Database archived')
```

### Restore a database

```ts [restore-database.ts]
const restored = await database.restore()
console.log('Database restored')
```

### Delete permanently

::warning
Permanent deletion cannot be undone. All data sources and rows will be lost.
::

```ts [delete-database.ts]
await database.delete()
console.log('Database permanently deleted')
```

## Ensure a database exists

Use `workspace.ensureDatabase()` for idempotent database setup. This searches for an existing database by title, syncs its schema, or creates a new one if not found.

```ts [ensure-database.ts]
const tasks = await workspace.ensureDatabase('Tasks', {
  parent: parentPage,
  schema: {
    name: { label: 'Name', type: 'title' },
    status: { label: 'Status', type: 'select', options: ['To Do', 'In Progress', 'Done'] },
    priority: { label: 'Priority', type: 'select', options: ['Low', 'Medium', 'High'] },
  },
  conflictStrategy: 'merge',
})

// Now you can query with typed records
for await (const task of tasks.find()) {
  console.log(task.name, task.status)
}
```

### Conflict strategies

When the remote database has a different schema than your local definition:

| Strategy | Behavior |
|----------|----------|
| `strict` | Throws an error if remote has fields not in your schema |
| `merge` | Keeps remote fields, adds/updates your fields (default) |
| `overwrite` | Replaces remote schema entirely, removing extra fields |

```ts [ensure-strategies.ts]
// Strict: fail if remote has unknown fields
const strict = await workspace.ensureDatabase('Tasks', {
  parent: parentPage,
  schema: mySchema,
  conflictStrategy: 'strict',
})

// Merge: keep remote fields, add yours
const merged = await workspace.ensureDatabase('Tasks', {
  parent: parentPage,
  schema: mySchema,
  conflictStrategy: 'merge',
})

// Overwrite: replace remote schema entirely
const overwritten = await workspace.ensureDatabase('Tasks', {
  parent: parentPage,
  schema: mySchema,
  conflictStrategy: 'overwrite',
})
```
