---
title: Hydration
description: Learn how to transform data between API format and JavaScript objects.
navigation:
  icon: i-lucide-droplets
---

When working with data sources, you often need to convert property values between the raw API format and simple JavaScript objects. This process is called **hydration** (API → JavaScript) and **dehydration** (JavaScript → API).

::tip
Note that when using `dataSource.withSchema()`, hydration and dehydration are handled automatically for you during queries and mutations. See the [Data Sources guide](../3.data-sources.md) for details.
::

::tabs{.w-full}
::tabs-item{icon="i-lucide-braces" label="API Format"}
```ts
const apiData = {
  'Task Name': {
    type: 'title',
    title: [{ type: 'text', text: { content: 'Review PR' }, plain_text: 'Review PR' }],
  },
  'Due Date': {
    type: 'date',
    date: { start: '2024-03-15', end: null },
  },
}
```
::

::tabs-item{icon="i-lucide-file-json" label="JavaScript Objects"}
```ts
const jsData = {
  name: 'Review PR',
  dueDate: new Date('2024-03-15'),
}
```
::
::

## Hydrate API responses into JavaScript objects

When receiving data from the API, use `hydrate()` to convert property values into a typed JavaScript object based on a schema definition. This makes it easier to work with the data in your application.

::code-collapse
```ts [hydrate-example.ts]
import { hydrate } from '@unbook/core'
import type { Schema } from '@unbook/core'

// 1. Assume we have a schema definition.
const schema: Schema.Definition = {
  name: fields.title('Task Name'),
  status: fields.select('Status', ['To Do', 'In Progress', 'Done']),
  dueDate: fields.date('Due Date'),
  priority: fields.number('Priority'),
}

// 2. Given an API page object
const pageObject = {
  id: 'page-id',
  properties: {
    'Task Name': {
      type: 'title',
      title: [{ type: 'text', text: { content: 'Review PR' }, plain_text: 'Review PR' }],
    },
    'Status': {
      type: 'select',
      select: { name: 'In Progress', color: 'yellow' },
    },
    'Due Date': {
      type: 'date',
      date: { start: '2024-03-20', end: null },
    },
    'Priority': {
      type: 'number',
      number: 5,
    },
  },
}

// 3. Hydrate page properties
const record = hydrate(schema, pageObject.properties)

// 4. Access typed properties
console.log(record.name)     // 'Review PR'
console.log(record.status)   // 'In Progress'
console.log(record.dueDate)  // Date { 2024-03-20T00:00:00.000Z }
console.log(record.priority) // 5
```
::

## Dehydrate JavaScript objects into API requests

When creating or updating records from data sources, use `dehydrate()` to convert JavaScript objects back into the API format based on a schema definition. This ensures the data is correctly structured when we sent it to the API.

::code-collapse
```ts [dehydrate-example.ts]
import { dehydrate } from '@unbook/core'
import type { Schema, fields } from '@unbook/core'

// 1. Assume we have a JavaScript object
const schema: Schema.Definition = {
  name: fields.title('Task Name'),
  status: fields.select('Status', ['To Do', 'In Progress', 'Done']),
  dueDate: fields.date('Due Date'),
  priority: fields.number('Priority'),
}

// Dehydrate for API
const properties = dehydrate(schema, {
  name: 'New Task',
  status: 'To Do',
  dueDate: new Date('2024-04-01'),
  priority: 3,
})

// Use in page creation
const page = await adapter.createPage({
  parent: { database_id: 'db-id' },
  properties,
})
```
::
